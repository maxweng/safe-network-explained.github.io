---
layout: post
title:  "区块链爱好者安联网 SAFE Network 入门指南"
date:   2017-04-12 00:00:00 +0000
updated: 2017-04-22 00:00:00 +0000
categories: bitcoin
---
如果你已经知道比特币的工作方式，下文能够更好地帮助你了解安联网 (SAFE Network)，而不需再从头开始理解。

尽管安联网和比特币网络拥有非常相似的目标和结果，但它们工作方式的差异却相当大。如果下面的任何一个解释读起来比较费劲，那是因为比特币的概念只能延伸到描述部分的安联网。相似之处将让我们更方便地理解，但最终还是有局限性。

以下内容不是为了让你获得对安联网的全面了解，而是为进一步阅读SAFE的内容提供一个坚实的基础。每部分的标题就像一间大房子的每一个窗口，让我们得以从比特币的角度来窥视安联网。

## 目录
<ul>
<li><a id="blockchain_toc" href="#区块链" rel="nofollow">区块链</a></li>
<li><a id="proof-of-work-for-verification_toc" href="#工作量证明验证" rel="nofollow">工作量证明验证</a></li>
<li><a id="double-spend-prevention_toc" href="#双重花费问题预防" rel="nofollow">双重花费问题预防</a></li>
<li><a id="transaction-propagation_toc" href="#交易传播机制" rel="nofollow">交易传播机制</a></li>
<li><a id="zero-confirmations_toc" href="#零确认" rel="nofollow">零确认</a></li>
<li><a id="mining-block-reward_toc" href="#挖矿, 区块奖励, 币基" rel="nofollow">挖矿, 区块奖励, 币基</a></li>
</ul>

### 区块链

区块链是比特币最重要的创新。区块链的目的是为了达成对比特币网络中数据状态的一致性。

安联网与区块链目标解决相同的问题，即共识问题，但并不使用区块链。安联网解决共识问题的重大创新被称为“邻组共识（close group consensus）”。

对于比特币和区块链，其网络上每个节点都有网络所有数据的完整副本。随着新数据不断被添加到网络中，每个节点都需要保留所有数据的副本。

安联网对网络上每份数据只保留几个副本。每份数据由网络分配一组节点（约30个）来确保该份数据的完整性。对于数据的修改只能当对数据的真实状态在该组中达成绝大多数共识（约80％）时才可进行。因为只有相对较少的节点数必须就数据的真实状态达成一致，所以安联网之于比特币要更高效。

有些人可能有这样的疑问，应该是多大的群组才能确保足够的安全性呢？节点为什么不多一些，为什么不少一些？相较于通过证明来推导出这个数字，我们可以花些时间来考虑一下，比特币和安联网的共识规则希望实现的共同目标：数据不应容易丢失，损坏或错误地被修改。如果该组节点可以被人为操纵（被黑客入侵或贿赂等），则他们控制的数据将不被认为是安全的。这个问题就是通过“邻组共识”的“邻组”来解决的。

邻近度算法，是决定管理每份数据的节点群组如何形成的算法。该群组的成员由网络自动选择，所以是非常难以人为操纵的（而且该难度，类似比特币，会根据网络的大小而变化调整，随着网络扩大难度会越来越高）。这里就不再赘诉“邻组共识”算法的细节，相关内容可以参见安联网所使用的xor距离内容以及那里提到的相关资料。

如果直接比较比特币与安联网关于安全性的讲法，比特币是由“工作量证明”来保证安全，而安联网则是通过“邻组共识”来保障的。

想了解更多关于使用邻近群组，而非区块链，的共识算法，可以阅读Maidsafe博客上的关于[共识系统](https://blog.maidsafe.net/tag/consensus-systems/)的内容，以及关于不相交群组[Disjoint Groups](https://github.com/maidsafe/rfcs/blob/master/text/0037-disjoint-groups/0037-disjoint-groups.md).的讨论。

最后强调下，如同区块链是实现比特币的关键创新，邻组共识则是实现安联网提供相同功能但大幅提高效率的关键创新。

[返回目录](#blockchain_toc)

### 工作量证明验证

区块链的一个突破是，很容易验证用户拥有的数据是否真实在链上，而不是某个恶意用户发送的无效数据。可以做到这点，是因为工作量证明很容易验证但却很难创造出来。

那么安联网是如何确保用户收到的数据是来自“真实”的安联网，而不是来自某个恶意用户所伪造的网络呢？

这里共有两个主要的机制来代替工作量证明，并保护数据的完整性。

第一种机制称为“自加密”。存储在网络中的任何数据在发送出去之前由客户端自动加密。也就是说任何运行保管库节点（Valut，译者注：类似比特币网络的挖矿节点）的人都无法了解其储存的具体数据，因为只有数据的所有者才可以对该数据进行解密。这就使得创建包含恶意数据的另外一个网络并欺骗用户参与该假网络非常困难。

第二种机制是“链式邻组共识”。当数据发送到网络或从网络请求获取时，它必须在到达存储数据的最终位置之前通过一系列的节点和检查。这就是说，传输需要保存的数据的节点只是网络中节点链的一部分，而不是该数据的原始所有者。这种链接机制类似于TOR网络，因而需要保存的数据可以完全匿名。此外，所有数据都是可互换的，从链上的保管库节点或其他节点的角度看，没有任何数据会比其他数据更重要或不重要。这也使得非常难以隔离网络上某部分有特殊意义的数据子集，来用于创建假的伪造网络。

通过在客户端加密数据，再通过请求路径连接该数据从而保证完整性和一致性，创建客户端仍能接受的伪造网络变得非常困难。这就使得检测网络的伪造版本变得很简单，就像工作量证明使得检测假区块链非常简单。

“自加密”和“邻组共识”正是安联网可以保证完整性，而不使用工作量证明的原因。

更多内容可以查看[“自加密”](https://safenetwork.wiki/en/Security_-_Self_encryption)
这里可以查看关于[链式邻组共识](https://github.com/maidsafe/safe_vault/blob/87c64d6c74a403629b48d34bee9508706ca083b9/README.md#flows)以及[保管库节点工作方式](https://safenetwork.wiki/en/Vaults_(How_it_works)#Group_Consensus)

[返回目录](#blockchain_toc)

### 双重花费问题预防

比特币通常被称为解决了“双重花费问题”（简称，双花），也就是说比特币实现了数据的原子性，一致性，隔离性和耐用性（ACID）的同时，它又是一个分布式，去中心化、及不基于信任的网络。这在计算机科学和现实世界的应用中都意义巨大，因为这就是意味着已经花掉的钱可以确保已经花掉。或者对于数据来说，当数据被更改后，可以确保它被更改状态。

安联网也有一个类似比特币的代币，称为安联币 (Safecoin)。比特币的交易数据是不断添加到区块链。而安联币的所有权数据则是在安联网上不断更新。安联网是如何确保在安联网上使用的代币不受到双花的攻击呢？与比特币的实现相比又是如何呢？

让我们先建立对比特币和双花的一个基本理解。当接收到比特币时，不会被双花的信心取决于交易有多少个确认。双花在比特币上是可能的，只是非常难以做到。花费即可替代 (Replace-by-fee) 使得双花的时间窗口更大且执行更简单。并且，比特币的双花可以被认为是关于对交易信心概率的高低，而无法绝对确定交易最终性。

而这正是安联网相比特币的最大优势之一，即交易速度非常快，而且一旦交易完成，最终性也确定了。这是如何做到的呢？要了解，我们必须先看看比特币与 安联币 在网络上的数据表示方式的不同。

在比特币区块链上，比特币是分组的输出，并不作为分开的数据实体存在。例如，挖矿的奖励目前为每个区块25个 BTC（译者注：现在已经减半成为每个区块 12.5个 BTC），但这25个 BTC 是在单个交易中表示的，即25个币，1份数据。

不同的是，每个安联币都是一个分散的数据片，在网络上有自己的位置（就像安联网上普通的数据）。25个 安联币 就是在安联网上的25份不同数据。

实现代币的这种本质区别，就是安联币如何实现快速交易，并具有如此高的交易最终性的原因。安联币的交易机制与比特币是截然不同的。

安联币 是一个特殊的数据包（称为结构化数据），其中包含当前所有者和前一个所有者的详细信息。为了转让该币的所有权，当前所有者必须证明其所有权（类似于比特币交易中的签名）。如果他拥有该币，他可以将代币当前所有者的数据更改为新的所有者。一个 安联币 的“当前所有者”就像一个比特币交易的 utxo。 “先前所有者”就像生成 utxo 的输入。安联币 的所有权只可以追溯到上一个所有者，而比特币的所有权可以一直追溯到代币的创建，其中可能包括数以百计的所有者。

传输 安联币 是安联网上的单一原子数据事件。一旦完成，它将保持这种状态，直到新的所有者决定更改它。也没有办法使其回滚，而不像比特币那样可以回滚到mempool甚至是以前的孤块。

比较完成一笔交易的成本。在比特币中，交易的成本是该交易相对于整个块的大小乘以生成块的工作量证明的成本。在 安联币 中，该成本是获取数据所需的资源（邻组节点必须达成共识，再存储修改内容）乘以所花费的代币数量。与比特币交易相比，安联币 交易是非常高效的，因为邻组共识机制比生成工作量证明要便宜和快速得多。

[返回目录](#blockchain_toc)

### 交易传播机制

对于比特币的一个有趣的思考是，当有两个不同的交易却有相同的输出同时产生。当这种情况发生时，便开始了“竞赛”，即看哪个交易可以最快地传播到网络的所有其他节点。接收到一个交易的节点最终也将接收到第二个交易，在这种情况下，它就会忽略第二个交易。这就是所谓中继策略和交易传播的“首例”原则。

然而，包含在区块链中的实际交易却完全取决于矿工们选择包含哪些，甚至可能是一个从未传播到网络上的交易（只要它是有效）。

这突出了比特币的一个有趣的属性 - 网络的“真实”状态只能从区块链中确定。在某些情况下，这可能相当久远了，甚至是超过一个小时之前发生的。这对于想要接受即时支付的商家产生一个很大的问题，例如店内的客户需要马上完成交易。

相比之下，安联网在处理真实性、和上述的“竞赛”情况是如何做的呢？如果一个客户端向网络的一部分广播了一个修改内容，并同时向网络的另一部分广播了另一个不同的修改内容，那这种情况该如何解决？

当在安联网上更改数据时，邻组节点的多数派（即该组的一个子集）必须达成共识同意修改。如果客户端同时宣布两个不同的修改内容，从而使得该组中三分之二的节点接收到一个版本，但另外三分之一接收到不同的版本，那么就不能达成共识，并且数据不会进行更改。

实际的工作方式比上述过程要更复杂，取决于数据是可变的还是不可变的，是一个PUT命令的还是一个POST命令都有所不同；详述这些细节会影响对基本概念的清晰理解，如果需要了解细节，可以自己另外研究一下。

可在这个博客上查看相关的文章 - [multiple store/delete](https://blog.maidsafe.net/2014/02/23/multiple-storedelete/) [pmidnode leave/join](https://blog.maidsafe.net/2014/03/07/pmidnode-leavejoin/)

[返回目录](#blockchain_toc)

### 零确认

如交易传播机制那部分所述的，比特币中的零确认交易不能完全被信任，考虑到花费即可替代性 (replace-by-fee)，那更无法完全信任了。

在安联网，交易的达成会非常快，通常不到一秒钟（网络还未正式上线，因此尚无法公开确认）。造成这种差异的原因是由于安联网的交易在实现和存储的不同。

比特币交易的实现是向区块链不断添加数据。由于添加数据需要一个新的区块，这既耗时又昂贵。在交易发布到网络上与其被包含到某个区块中的这段时间内，接收方并不能确定交易是否最终会被成功包含在一个区块中，因此，有了“零确认”交易这个说法，并且对此都非常谨慎。

安联币交易的实现是对已有数据的修改，即修改代币的当前所有者的信息。数据的更改由网络在原子操作中执行，并需要通过邻组共识机制达成一致。一旦邻组共识达成，即实现修改并是最终确定了。

因此，安联网没有零确认（甚至确认）这一概念，一旦提交给网络，交易就是最终确定的。即一旦邻组节点就变化达成共识（通常不到一秒）。

为了更好地了解交易是如何在安联网上进行的，一个好起点是去了解整个统一结构化数据[unified structured data](https://github.com/maidsafe/rfcs/blob/1cd4ed22709fed673f5ce51c1d861d879abd7aec/text/0000-Unified-structured-data/0000-Unified-structured-data.md)(RFC)。

[返回目录](#blockchain_toc)

### 挖矿, 区块奖励, 币基

比特币通过奖励新的代币来激励用户参与工作量证明机制。

那么，安联网是如何生成新的安联币s，以及网络参与的激励措施是如何组成的？

新的安联币s是由“资源证明(Proof of Resource)”产生的。

首先，想下比特币。如果用户可以提供有效的工作量证明，网络将为用户分配新的代币。代币数量由网络规则决定；如果不遵守规则，则工作量证明无效。当用户提供有效的资源证明时，就可以获得安联币。显然，我们需要了解资源证明是什么，以及与工作证明比较是如何的。

工作量证明验证用户花费了一定量的计算（这是统计学上的，但仍然是创造有效的证明）。资源证明则验证了用户能够提供一定量的资源（如存储，带宽，计算能力等）。

这两种证明方式都很容易验证，但很难创建。那么，资源证明是如何实现？

基本思路是证明一个节点可以提供资源，而不需实际提供资源。这就像工作量证明，一个节点可以证明它的工作量，而不需要任何其他节点实际上再做一遍这个工作。

资源证明的算法是惊人的简单和聪明：

* 一组检测节点创建一个随机字符串；
* 这个随机字符串被加密地发送到保存数据的数据存储节点；
* 每个数据存储节点采用此字符串，将其附加到原始数据，并对结果进行哈希运算；
* 每个数据存储节点的结果由检测组收集和解密，并与所有数据节点的结果相比较；
* 如果任何数据存储节点返回不同的结果，则认为该节点已被破坏并被降级。

如此正说明邻组共识机制的概念在安联网中的重要性。它构成了网络上基本每一个单一操作的基础。

这里聪明之处在于，做检测的节点不需要实际拥有数据来做检查。他们依赖于最初以特定方式存储的数据（即，邻组节点达成的共识），这样可以在将来再次检查数据，而不需要获得数据本身的副本。

在这里了解更多关于资源证明[proof of resource](https://safenetwork.wiki/en/Proof_of_resource)的内容

安联币[Safecoin](https://github.com/maidsafe/rfcs/blob/cd47937ebf053e90bde20f18eced2866854e8234/text/0012-安联币-implementation/0012-安联币-implementation.md) RFC中的信息也很有价值。

[返回目录](#blockchain_toc)
